<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>مسابقة</title>
<style>
body {
    background: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
#box {
    width: 90%;
    max-width: 500px;
    background: #111;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
}
input, button {
    width: 90%;
    padding: 10px;
    margin: 8px 0;
    border-radius: 6px;
    border: none;
}
button {
    background: #444;
    color: #fff;
    cursor: pointer;
}
button:hover { background: #666; }
img, iframe {
    width: 100%;
    border-radius: 10px;
    margin-top: 10px;
}
#adminPanel {
    display: none;
    margin-top: 20px;
    background: #222;
    padding: 15px;
    border-radius: 10px;
}
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
th, td {
    border: 1px solid #555;
    padding: 8px;
    text-align: center;
}
</style>
</head>
<body>

<div id="box">
    <h2>مرحباً بالمشارك</h2>

    <div id="nameSection">
        <input id="playerName" placeholder="اكتب اسمك للدخول">
        <button onclick="enterGame()">دخول</button>
    </div>

    <div id="contentSection" style="display:none;">
        <div id="contestMedia"></div>
        <h3 id="question">ما هو السؤال؟</h3>
        <input id="answer" placeholder="اكتب إجابتك">
        <button onclick="submitAnswer()">إرسال الإجابة</button>
        <p id="scoreText"></p>
    </div>

    <button onclick="adminLogin()">دخول المالك</button>

    <div id="adminPanel">
        <h3>لوحة المالك</h3>
        <button onclick="resetScores()">تصفير النقاط</button>
        <button onclick="deletePlayers()">حذف جميع المشتركين</button>
        <button onclick="changeQuestion()">تغيير السؤال</button>
        <h3>قائمة المشتركين</h3>
        <table id="playersTable">
            <tr><th>الاسم</th><th>النقاط</th></tr>
        </table>
    </div>
</div>

<script>
// =================== بيانات اللعبة ===================
let correctAnswer = "الإجابة الصحيحة";
let currentQuestionID = localStorage.getItem("questionID") || "1";

// =================== إدارة المشتركين ===================
function loadPlayersList() {
    return JSON.parse(localStorage.getItem("players_list")) || [];
}
function savePlayersList(list) {
    localStorage.setItem("players_list", JSON.stringify(list));
}
function addPlayer(name) {
    let list = loadPlayersList();
    if (!list.includes(name)) { list.push(name); savePlayersList(list); }
}

// =================== بدء اللعبة ===================
function enterGame() {
    let name = document.getElementById("playerName").value.trim();
    if (!name) return alert("اكتب اسمك!");

    addPlayer(name);

    let savedID = localStorage.getItem(name + "_question");
    if (savedID === currentQuestionID) {
        alert("لقد شاركت في هذا السؤال بالفعل!");
        return;
    }

    localStorage.setItem("currentPlayer", name);
    document.getElementById("nameSection").style.display = "none";
    document.getElementById("contentSection").style.display = "block";

    updateScoreText();
}

// =================== إرسال الإجابة ===================
function submitAnswer() {
    let name = localStorage.getItem("currentPlayer");
    let ans = document.getElementById("answer").value.trim();
    if (!ans) return alert("اكتب إجابتك!");

    if (ans === correctAnswer) {
        let oldScore = Number(localStorage.getItem(name + "_score")) || 0;
        localStorage.setItem(name + "_score", oldScore + 3);
        alert("إجابة صحيحة! +3 نقاط");
    } else {
        alert("إجابة خاطئة");
    }

    localStorage.setItem(name + "_question", currentQuestionID);
    updateScoreText();
}

// =================== تحديث النقاط ===================
function updateScoreText() {
    let name = localStorage.getItem("currentPlayer");
    let score = Number(localStorage.getItem(name + "_score")) || 0;
    document.getElementById("scoreText").innerText = "نقاطك: " + score;
}

// =================== لوحة المالك ===================
function adminLogin() {
    let pass = prompt("ادخل كلمة السر");
    if (pass === "Dosary") {
        document.getElementById("adminPanel").style.display = "block";
        showPlayers();
    } else alert("كلمة السر خاطئة");
}

function showPlayers() {
    let table = document.getElementById("playersTable");
    table.innerHTML = `<tr><th>الاسم</th><th>النقاط</th></tr>`;
    let list = loadPlayersList();
    list.forEach(name=>{
        let score = Number(localStorage.getItem(name + "_score")) || 0;
        table.innerHTML += `<tr><td>${name}</td><td>${score}</td></tr>`;
    });
}

// =================== تصفير النقاط ===================
function resetScores() {
    if (!confirm("هل تريد تصفير النقاط؟")) return;
    let list = loadPlayersList();
    list.forEach(name=>localStorage.removeItem(name + "_score"));
    showPlayers();
    alert("تم تصفير جميع النقاط");
}

// =================== حذف المشتركين ===================
function deletePlayers() {
    if (!confirm("هل تريد حذف جميع المشتركين؟")) return;
    localStorage.removeItem("players_list");
    for (let key in localStorage) {
        if (key.endsWith("_score") || key.endsWith("_question")) localStorage.removeItem(key);
    }
    showPlayers();
    alert("تم حذف جميع المشتركين");
}

// =================== تغيير السؤال ===================
function changeQuestion() {
    let newQ = prompt("اكتب السؤال الجديد");
    if (!newQ) return;
    document.getElementById("question").innerText = newQ;

    correctAnswer = prompt("اكتب الإجابة الصحيحة");
    if (!correctAnswer) return;

    currentQuestionID = Date.now().toString();
    localStorage.setItem("questionID", currentQuestionID);

    alert("تم تغيير السؤال — ويمكن للمشاركين المشاركة مرة أخرى");
}

// =================== تحديث الوسائط ===================
function updateMediaDisplay(url){
    let container = document.getElementById("contestMedia");
    if(!url || url.trim()===""){ container.innerHTML=""; return; }

    if(url.match(/\.(jpg|png|jpeg|gif)$/)){
        container.innerHTML = `<img src="${url}">`;
    } else if(url.includes("youtube.com") || url.includes("youtu.be")){
        let id = url.split("v=")[1] || url.split("youtu.be/")[1];
        container.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}" height="300" frameborder="0" allowfullscreen></iframe>`;
    } else if(url.includes("streamable.com")){
        let id = url.split("/").pop();
        container.innerHTML = `<iframe src="https://streamable.com/e/${id}" height="300" frameborder="0" allowfullscreen></iframe>`;
    } else {
        container.innerHTML = `<iframe src="${url}" height="300" frameborder="0" allowfullscreen></iframe>`;
    }
}

// ضع رابط الصورة أو الفيديو هنا
updateMediaDisplay("https://via.placeholder.com/400x200");
</script>

</body>
</html>
